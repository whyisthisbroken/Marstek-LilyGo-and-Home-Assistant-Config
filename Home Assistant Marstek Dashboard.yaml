path: marstekbattery
icon: mdi:battery
type: sections
max_columns: 3
dense_section_placement: true
header:
  card:
    type: markdown
    content: "# üîã Marstek Batterie √úbersicht"
  layout: center
  badges_position: bottom
  badges_wrap: wrap
badges:
  - type: custom:mushroom-template-badge
    content: "Status: {{ states('sensor.marstek_inverter_state') }}"
    icon: mdi:battery-sync
    color: |
      {% if states('sensor.marstek_inverter_state') in ['Online', 'Running'] %}
        green
      {% else %}
        red
      {% endif %}
  - type: custom:mushroom-template-badge
    content: |
      WiFi Signal: {{ states('sensor.marstek_wifi_signal_strength') }} dBm
    icon: mdi:wifi
    color: >
      {% set rssi = states('sensor.marstek_wifi_signal_strength') | int %} {% if
      rssi < -80 %} red {% elif rssi < -65 %} orange {% else %} green {% endif
      %}
  - type: custom:mushroom-template-badge
    content: >
      Temp intern: {{ states('sensor.marstek_internal_temperature') | float |
      round(1) }}¬∞C
    icon: mdi:thermometer
    color: >
      {% set t = states('sensor.marstek_internal_temperature') | float %} {% if
      t < 30 %} green {% elif t < 45 %} orange {% else %} red {% endif %}
    tap_action:
      action: more-info
    entity: sensor.marstek_internal_temperature
sections:
  - type: grid
    cards:
      - type: custom:mushroom-title-card
        title: üß∞ Zellinfos
      - type: horizontal-stack
        cards:
          - type: tile
            entity: sensor.marstek_battery_state_of_charge
            name: Ladezustand
            icon: mdi:battery-charging
            features_position: bottom
            vertical: false
            show_entity_picture: false
            hide_state: false
            features:
              - type: bar-gauge
          - type: tile
            entity: sensor.marstek_battery_remaining_capacity
            name: Restkapazit√§t
            icon: mdi:battery
            features_position: bottom
            vertical: false
            features:
              - type: trend-graph
      - type: vertical-stack
        cards:
          - type: custom:mushroom-template-badge
            entity: sensor.marstek_battery_voltage
            content: >
              {% set val = states('sensor.marstek_battery_voltage') %} {% if val
              not in ['unknown', 'unavailable', None, ''] %}
                Durchs. Batteriesp.: {{ '{0:.1f}'.format(val | float) }} V
              {% else %}
                Durchs. Batteriesp.: --
              {% endif %}
            icon: mdi:car-battery
            color: >
              {% set v = states('sensor.marstek_battery_voltage') | float(0) %}
              {% if v < 50 %}
                red
              {% else %}
                green
              {% endif %}
            tap_action:
              action: more-info
          - type: custom:mushroom-template-badge
            content: >
              {% set val = states('sensor.marstek_zellspannungsdifferenz') %} {%
              if val not in ['unknown', 'unavailable', None] %}
                Zellspannungsdiff.: {{ '{0:.0f}'.format(val | float * 1000) }} mV
              {% else %} Zellspannungsdiff.: -- {% endif %}
            icon: mdi:flash-alert
            color: >
              {% set v = states('sensor.marstek_zellspannungsdifferenz') | float
              %} {% if v > 0.010 %} red {% elif v >= 0.008 %} orange {% else %}
              green {% endif %}
            tap_action:
              action: more-info
            entity: sensor.marstek_zellspannungsdifferenz
          - type: horizontal-stack
            cards:
              - type: custom:mushroom-entity-card
                entity: sensor.marstek_max_zellenspannung
                name: Maximale Zellensp.
                icon: mdi:flash-outline
              - type: custom:mushroom-entity-card
                entity: sensor.marstek_min_zellenspannung
                name: Minimale Zellensp.
                icon: mdi:flash-outline
          - type: horizontal-stack
            cards:
              - type: custom:mushroom-entity-card
                entity: sensor.marstek_internal_mos1_temperature
                name: MOS1 Temp.
                icon: mdi:thermometer-lines
              - type: custom:mushroom-entity-card
                entity: sensor.marstek_internal_mos2_temperature
                name: MOS2 Temp.
                icon: mdi:thermometer-lines
          - type: horizontal-stack
            cards:
              - type: custom:mushroom-entity-card
                entity: sensor.marstek_max_cell_temperature
                name: Zelltemp. Max
                icon: mdi:thermometer-high
              - type: custom:mushroom-entity-card
                entity: sensor.marstek_min_cell_temperature
                name: Zelltemp. Min
                icon: mdi:thermometer-low
  - type: grid
    cards:
      - type: vertical-stack
        cards:
          - type: custom:mushroom-title-card
            title: ‚ö° AC & DC Werte
          - type: custom:mushroom-entity-card
            entity: sensor.marstek_ac_power
            name: AC Power
            icon: mdi:flash
            icon_color: yellow
          - type: custom:mushroom-entity-card
            entity: sensor.marstek_ac_voltage
            name: AC Volt
            icon: mdi:power-plug
          - type: custom:mushroom-entity-card
            entity: sensor.marstek_ac_current
            name: AC Strom
            icon: mdi:current-ac
          - type: custom:mushroom-entity-card
            entity: sensor.marstek_battery_voltage
            name: DC Volt
            icon: mdi:power-socket
          - type: custom:mushroom-entity-card
            entity: sensor.marstek_battery_current
            name: DC Strom
            icon: mdi:current-dc
          - type: custom:mushroom-entity-card
            entity: sensor.marstek_battery_power
            name: DC Power
            icon: mdi:flash-outline
  - type: grid
    cards:
      - type: vertical-stack
        cards:
          - type: custom:mushroom-title-card
            title: üåê Netzwerk & Verbindung
          - type: custom:mushroom-entity-card
            entity: sensor.marstek_esphome_ip
            name: IP-Adresse
          - type: custom:mushroom-entity-card
            entity: sensor.marstek_esphome_ssid
            name: WLAN SSID
          - type: custom:mushroom-entity-card
            entity: sensor.marstek_battery_wifi_status
            name: WLAN-Status
          - type: custom:mushroom-entity-card
            entity: sensor.marstek_bt_status
            name: Bluetooth-Status
          - type: custom:mushroom-entity-card
            entity: sensor.marstek_cloud_status
            name: Cloud-Anbindung
          - type: custom:mushroom-entity-card
            entity: binary_sensor.marstek_network_abnormal
            name: Netzwerk Problem
          - type: custom:mushroom-entity-card
            entity: binary_sensor.marstek_wifi_abnormal
            name: WLAN Problem
  - type: grid
    cards:
      - type: custom:mushroom-title-card
        title: üìä Energie-Ertrag
      - type: vertical-stack
        cards:
          - type: custom:mushroom-entity-card
            entity: sensor.monats_effizienz
            name: Monats-Effizienz
            icon: mdi:calendar-month
            icon_color: purple
            hold_action:
              action: none
            double_tap_action:
              action: none
            tap_action:
              action: more-info
          - type: custom:mushroom-entity-card
            entity: sensor.totale_effizienz
            name: Totale-Effizienz
            icon: mdi:battery-high
            icon_color: blue
            tap_action:
              action: more-info
            hold_action:
              action: none
            double_tap_action:
              action: none
      - type: vertical-stack
        cards:
          - type: custom:mushroom-entity-card
            entity: sensor.marstekbattery_gesamte_tagesladung
            name: Tagesladung
            icon: mdi:calendar-today
          - type: custom:mushroom-entity-card
            entity: sensor.marstekbattery_gesamte_tagesentladung
            name: Tagesentladung
            icon: mdi:calendar-today-outline
          - type: custom:mushroom-entity-card
            entity: sensor.marstekbattery_gesamte_monatsladung
            name: Monatsladung
            icon: mdi:calendar-month
          - type: custom:mushroom-entity-card
            entity: sensor.marstekbattery_gesamte_monatsentladung
            name: Monatsentladung
            icon: mdi:calendar-month-outline
          - type: custom:mushroom-entity-card
            entity: sensor.batterie_ladung
            name: Gesamte Ladung
            icon: mdi:calendar-month-outline
          - type: custom:mushroom-entity-card
            entity: sensor.batterie_entladung
            name: Gesamte Entladung
            icon: mdi:calendar-month-outline
      - type: vertical-stack
        cards:
          - type: custom:mushroom-title-card
            title: üì¶ Systeminformationen
          - type: custom:mushroom-entity-card
            entity: sensor.marstek_software_version
            name: Software-Version
          - type: custom:mushroom-entity-card
            entity: sensor.marstek_firmware_version
            name: Firmware-Version
          - type: custom:mushroom-entity-card
            entity: sensor.marstek_bms_version
            name: BMS-Version
          - type: custom:mushroom-entity-card
            entity: sensor.marstek_esp_version
            name: ESPHome-Version
  - type: grid
    cards:
      - type: vertical-stack
        cards:
          - type: custom:mushroom-title-card
            title: ‚öôÔ∏è Steuerung & Einstellungen
          - type: custom:mushroom-entity-card
            entity: number.marstek_forcible_charge_power
            name: Forcierte Ladung
            icon: mdi:battery-plus
          - type: custom:mushroom-entity-card
            entity: number.marstek_forcible_discharge_power
            name: Forcierte Entladung
            icon: mdi:battery-minus
          - type: custom:mushroom-entity-card
            entity: number.marstek_max_charge_power
            name: Max. Ladeleistung
            icon: mdi:transmission-tower-export
          - type: custom:mushroom-entity-card
            entity: number.marstek_max_discharge_power
            name: Max. Entladeleistung
            icon: mdi:transmission-tower-import
          - type: custom:mushroom-entity-card
            entity: number.marstek_charge_to_soc
            name: Ladeziel-SOC
            icon: mdi:battery-charging-100
          - type: custom:mushroom-entity-card
            entity: number.marstek_charging_cutoff_capacity
            name: Ladeabschaltung bei
            icon: mdi:battery-off
          - type: custom:mushroom-entity-card
            entity: number.marstek_discharging_cutoff_capacity
            name: Entladeabschaltung bei
            icon: mdi:battery-arrow-down
          - type: custom:mushroom-entity-card
            entity: select.marstek_user_work_mode
            name: Work Mode
            icon: mdi:cog-outline
          - type: custom:mushroom-entity-card
            entity: button.stick_restart
            name: Stick Neustarten
            icon: mdi:restart
  - type: grid
    cards:
      - type: vertical-stack
        cards:
          - type: custom:mushroom-title-card
            title: üö® Fehler & Warnungen
          - type: custom:mushroom-entity-card
            entity: binary_sensor.marstek_fan_abnormal_warning
            name: L√ºfterfehler
          - type: custom:mushroom-entity-card
            entity: binary_sensor.marstek_low_battery_soc_warning
            name: SOC niedrig
          - type: custom:mushroom-entity-card
            entity: binary_sensor.marstek_overtemperature_limit
            name: √úbertemperatur
          - type: custom:mushroom-entity-card
            entity: binary_sensor.marstek_grid_overvoltage
            name: Netzspannung zu hoch
          - type: custom:mushroom-entity-card
            entity: binary_sensor.marstek_bat_communication_failure
            name: Kommunikation Batterie
          - type: custom:mushroom-entity-card
            entity: binary_sensor.marstek_bms_protect
            name: BMS Schutz aktiv
          - type: custom:mushroom-entity-card
            entity: sensor.marstek_power_restriction
            name: Leistungsbeschr√§nkung
            icon: mdi:alert
cards: []
title: Marstek
